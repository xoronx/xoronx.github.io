!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Bytescale=t():e.Bytescale=t()}(self,(function(){return function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(){}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key),"symbol"===r(i)?i:String(i)),o)}var i}e.r(t),e.d(t,{AuthManager:function(){return nt},BaseAPI:function(){return T},BinaryResult:function(){return C},BytescaleApiClientConfigUtils:function(){return k},BytescaleApiError:function(){return A},CancelledError:function(){return E},CommonTypesNoOp:function(){return de},FileApi:function(){return J},FolderApi:function(){return V},JSONApiResponse:function(){return R},JobApi:function(){return ne},UploadApi:function(){return fe},UploadManager:function(){return Qe},UrlBuilder:function(){return we},UrlBuilderTypesNoOp:function(){return ge},VoidApiResponse:function(){return q},querystring:function(){return U}});var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.locked=!1,this.queue=[]}var t,r;return t=e,(r=[{key:"safe",value:function(e){try{var t=this;return r=t.lock(),n=function(){return function(e,t){try{var r=e()}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(e,(function(e,r){return t.unlock(),function(e,t){if(e)throw t;return t}(e,r)}))},r&&r.then||(r=Promise.resolve(r)),n?r.then(n):r}catch(e){return Promise.reject(e)}var r,n}},{key:"lock",value:function(){try{var e=this;return t=function(t){e.locked=!0},(r=function(){if(e.locked){var t,r=new Promise((function(e){t=e}));if(void 0===t)throw new Error("unlockNext was undefined");return e.queue.push({resolve:t}),(o=r)&&o.then?o.then(n):Promise.resolve()}var o}())&&r.then?r.then(t):t()}catch(e){return Promise.reject(e)}var t,r}},{key:"unlock",value:function(){if(!this.locked)throw new Error("Mutex is not locked.");var e=this.queue.shift();void 0!==e?e.resolve():this.locked=!1}}])&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===c(o)?o:String(o)),n)}var o}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"getMutex",value:function(){var t=e.mutexKey,r=window[t];return void 0===r&&(r=new i,window[t]=r),r}},{key:"setSession",value:function(t){window[e.stateKey]=t}},{key:"getSession",value:function(){if("undefined"!=typeof window)return window[e.stateKey]}}],null&&a(t.prototype,null),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function f(e){var t=h();return function(){var r,n=m(e);if(t){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}function d(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){var t="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return y(e,arguments,m(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,e)},p(e)}function y(e,t,r){return y=h()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&v(o,r.prototype),o},y.apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function b(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}function P(){}function w(e,t){return e&&e.then?e.then(t):t(e)}function g(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,O(n.key),n)}}function I(e,t,r){return t&&S(e.prototype,t),r&&S(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function O(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===l(t)?t:String(t)}u.stateKey="BytescaleSessionState",u.mutexKey="BytescaleSessionStateMutex";var k=function(){function e(){j(this,e)}return I(e,null,[{key:"getApiUrl",value:function(t){var r;return null!==(r=t.apiUrl)&&void 0!==r?r:e.defaultApiUrl}},{key:"getCdnUrl",value:function(t){var r;return null!==(r=t.cdnUrl)&&void 0!==r?r:e.defaultCdnUrl}},{key:"getFetchApi",value:function(e){var t;return null!==(t=e.fetchApi)&&void 0!==t?t:fetch}},{key:"getAccountId",value:function(t){var r,n,o;if(e.specialApiKeys.includes(t.apiKey))o=e.specialApiKeyAccountId;else if((o=null!==(n=null===(r=t.apiKey.split("_")[1])||void 0===r?void 0:r.substr(0,e.accountIdLength))&&void 0!==n?n:"").length!==e.accountIdLength)throw new Error("Invalid Bytescale API key.");return o}},{key:"validate",value:function(t){var r;if(void 0===(null!=t?t:void 0))throw new Error("Config parameter required.");if(void 0===(null!==(r=t.apiKey)&&void 0!==r?r:void 0))throw new Error("Please provide an API key via the 'apiKey' config parameter.");if(t.apiKey.trim()!==t.apiKey)throw new Error("API key needs trimming (whitespace detected).");e.getAccountId(t)}}]),e}();k.defaultApiUrl="https://api.bytescale.com",k.defaultCdnUrl="https://upcdn.io",k.specialApiKeys=["free","demo"],k.specialApiKeyAccountId="W142hJk",k.accountIdLength=7;var T=function(){function e(t){j(this,e),this.config=t,k.validate(t)}return I(e,[{key:"request",value:function(t,r,n){try{var o,i=this,c=i.config.apiKey;t.headers.Authorization="Bearer ".concat(c);var a=u.getSession();void 0!==(null==a?void 0:a.accessToken)&&(t.headers["Authorization-Token"]=a.accessToken);var l=(s={},f=k.defaultCdnUrl,d=k.getCdnUrl(i.config),(f=O(f))in s?Object.defineProperty(s,f,{value:d,enumerable:!0,configurable:!0,writable:!0}):s[f]=d,s);return g(i.createFetchParams(t,r,void 0===n?void 0:null!==(o=l[n])&&void 0!==o?o:n),(function(t){var r=t.url,n=t.init;return e.fetch(r,n,Object.assign(Object.assign({},i.config),{isBytescaleApi:!0}))}))}catch(e){return Promise.reject(e)}var s,f,d}},{key:"encodeParam",value:function(e,t){if("filePath"===e){if(!t.startsWith("/"))throw new Error("The 'filePath' parameter must begin with a '/' character.");return t}return encodeURIComponent(t)}},{key:"createFetchParams",value:function(e,t,r){try{var n=(null!=r?r:k.getApiUrl(this.config))+e.path;void 0!==e.query&&0!==Object.keys(e.query).length&&(n+="?"+U(e.query));var o=this.config.headers,i=Object.assign({},e.headers);return g(void 0===o?{}:"function"==typeof o?o():o,(function(r){var o=Object.assign(i,r);Object.keys(o).forEach((function(e){return void 0===o[e]?delete o[e]:{}}));var c="function"==typeof t?t:function(){return g(t)},a={method:e.method,headers:o,body:e.body},u=Object.assign({},a);return g(c({init:a,context:e}),(function(e){var t=Object.assign(u,e),r=Object.assign(Object.assign({},t),{body:JSON.stringify(t.body)});return{url:n,init:r}}))}),void 0===o||!("function"==typeof o))}catch(e){return Promise.reject(e)}}}],[{key:"fetch",value:function(e,t,r){try{var n,o,i;return w(b((function(){return g(k.getFetchApi(r)(e,Object.assign(Object.assign({},t),{cache:"no-store"})),(function(e){i=e}))}),(function(t){throw new Error(r.isBytescaleApi?"Unable to resolve the Bytescale API: ".concat(t.message," If the problem persists, and your network connection is OK, then please contact support@bytescale.com and provide: (a) time of failed request in UTC (b) screenshot of failed network response header + body (c) screenshot of failed network request header + body (d) browser and OS version."):"Unable to resolve URL (".concat(e,"): ").concat(t.message))})),(function(c){var a,u;return i.status>=200&&i.status<300?i:(a=function(r){throw new Error("Failure status code (".concat(i.status,") received for request: ").concat(null!==(o=t.method)&&void 0!==o?o:"GET"," ").concat(e))},(u=function(){if(r.isBytescaleApi){var e=void 0;return w(b((function(){return g(i.json(),(function(t){e=t}))}),P),(function(){if("string"==typeof(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n.code))throw new A(e);throw new Error("Unable to connect to the Bytescale API (".concat(i.status,"): please try again."))}))}}())&&u.then?u.then(a):a())}))}catch(e){return Promise.reject(e)}}}]),e}(),E=function(e){s(r,e);var t=f(r);function r(){var e;return j(this,r),(e=t.call(this,"Operation cancelled by caller.")).name="CancelledError",e}return I(r)}(p(Error)),A=function(e){s(r,e);var t=f(r);function r(e){var n;return j(this,r),(n=t.call(this,e.error.message)).name="BytescaleApiError",n.errorCode=e.error.code,n.details=e.error.details,n}return I(r)}(p(Error));function U(e){return Object.keys(e).map((function(t){return function(e,t){return t instanceof Object?U(t):"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(String(t)))}(t,e[t])})).filter((function(e){return e.length>0})).join("&")}var R=function(){function e(t){j(this,e),this.raw=t}return I(e,[{key:"value",value:function(){try{return g(this.raw.json())}catch(e){return Promise.reject(e)}}}]),e}(),q=function(){function e(t){j(this,e),this.raw=t}return I(e,[{key:"value",value:function(){return g(void 0)}}]),e}(),C=function(){function e(t){j(this,e),this.raw=t}return I(e,[{key:"stream",value:function(){if(this.raw.bodyUsed)throw new Error("Response body has already been consumed.");if(null===this.raw.body)throw new Error("Response body does not exist.");return this.raw.body}},{key:"text",value:function(){try{return g(this.raw.text())}catch(e){return Promise.reject(e)}}},{key:"blob",value:function(){try{return g(this.raw.blob())}catch(e){return Promise.reject(e)}}},{key:"json",value:function(){try{return g(this.raw.json())}catch(e){return Promise.reject(e)}}}]),e}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function _(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==x(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===x(o)?o:String(o)),n)}var o}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function N(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(n);if(o){var r=D(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return N(this,e)});function c(){return B(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"copyFile",value:function(e){try{return _(this.request({path:"/v2/accounts/{accountId}/files/copy".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.copyFileRequest},void 0,[][0]),(function(e){return _(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"copyFileBatch",value:function(e){try{return _(this.request({path:"/v2/accounts/{accountId}/files/copy/batch".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.copyFileBatchRequest},void 0,[][0]),(function(e){return _(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"deleteFile",value:function(e){try{var t={};return void 0!==e.filePath&&(t.filePath=e.filePath),_(this.request({path:"/v2/accounts/{accountId}/files".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"DELETE",headers:{},query:t},void 0,[][0]),(function(e){return _(new q(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"deleteFileBatch",value:function(e){try{return _(this.request({path:"/v2/accounts/{accountId}/files/batch".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"DELETE",headers:{"Content-Type":"application/json"},query:{},body:e.deleteFileBatchRequest},void 0,[][0]),(function(e){return _(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"downloadFile",value:function(e){try{var t=this,r={};return void 0!==e.cache&&(r.cache=e.cache),void 0!==e.cacheTtl&&(r.cache_ttl=e.cacheTtl),void 0!==e.version&&(r.version=e.version),_(t.request({path:"/{accountId}/raw{filePath}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("filePath","}"),t.encodeParam("filePath",e.filePath)),method:"GET",headers:{},query:r},void 0,"https://upcdn.io"),(function(e){return new C(e)}))}catch(e){return Promise.reject(e)}}},{key:"getFileDetails",value:function(e){try{var t={};return void 0!==e.filePath&&(t.filePath=e.filePath),_(this.request({path:"/v2/accounts/{accountId}/files/details".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"GET",headers:{},query:t},void 0,[][0]),(function(e){return _(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"processFile",value:function(e){try{var t=this,r={};return void 0!==e.artifact&&(r.artifact=e.artifact),void 0!==e.cache&&(r.cache=e.cache),void 0!==e.cachePerm&&(r.cache_perm=e.cachePerm),void 0!==e.cacheTtl&&(r.cache_ttl=e.cacheTtl),void 0!==e.transformationParams&&(r.transformationParams=e.transformationParams),void 0!==e.version&&(r.version=e.version),_(t.request({path:"/{accountId}/{transformation}{filePath}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("filePath","}"),t.encodeParam("filePath",e.filePath)).replace("{".concat("transformation","}"),t.encodeParam("transformation",e.transformation)),method:"GET",headers:{},query:r},void 0,"https://upcdn.io"),(function(e){return new C(e)}))}catch(e){return Promise.reject(e)}}},{key:"processFileAndSave",value:function(e){try{var t=this,r={};void 0!==e.transformationParams&&(r.transformationParams=e.transformationParams);return _(t.request({path:"/{accountId}/save/{transformation}{filePath}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("filePath","}"),t.encodeParam("filePath",e.filePath)).replace("{".concat("transformation","}"),t.encodeParam("transformation",e.transformation)),method:"POST",headers:{"Content-Type":"application/json"},query:r,body:e.processFileAndSaveRequest},void 0,"https://upcdn.io"),(function(e){return _(new R(e).value())}))}catch(e){return Promise.reject(e)}}}])&&F(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(T);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function L(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==K(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===K(o)?o:String(o)),n)}var o}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}function H(e,t){if(t&&("object"===K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(n);if(o){var r=W(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return H(this,e)});function c(){return z(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"copyFolder",value:function(e){try{return L(this.request({path:"/v2/accounts/{accountId}/folders/copy".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.copyFolderRequest},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"copyFolderBatch",value:function(e){try{return L(this.request({path:"/v2/accounts/{accountId}/folders/copy/batch".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.copyFolderBatchRequest},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"deleteFolder",value:function(e){try{return L(this.request({path:"/v2/accounts/{accountId}/folders".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"DELETE",headers:{"Content-Type":"application/json"},query:{},body:e.deleteFolderRequest},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"deleteFolderBatch",value:function(e){try{return L(this.request({path:"/v2/accounts/{accountId}/folders/batch".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"DELETE",headers:{"Content-Type":"application/json"},query:{},body:e.deleteFolderBatchRequest},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"getFolderDetails",value:function(e){try{var t={};return void 0!==e.folderPath&&(t.folderPath=e.folderPath),L(this.request({path:"/v2/accounts/{accountId}/folders".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"GET",headers:{},query:t},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"listFolder",value:function(e){try{var t={};return void 0!==e.cursor&&(t.cursor=e.cursor),void 0!==e.dryRun&&(t.dryRun=e.dryRun),void 0!==e.folderPath&&(t.folderPath=e.folderPath),void 0!==e.includeFiles&&(t.includeFiles=e.includeFiles),void 0!==e.includeOverriddenStorage&&(t.includeOverriddenStorage=e.includeOverriddenStorage),void 0!==e.includePhysicalFolders&&(t.includePhysicalFolders=e.includePhysicalFolders),void 0!==e.includeVirtualFolders&&(t.includeVirtualFolders=e.includeVirtualFolders),void 0!==e.limit&&(t.limit=e.limit),void 0!==e.recursive&&(t.recursive=e.recursive),L(this.request({path:"/v2/accounts/{accountId}/folders/list".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"GET",headers:{},query:t},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"putFolder",value:function(e){try{return L(this.request({path:"/v2/accounts/{accountId}/folders".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"PUT",headers:{"Content-Type":"application/json"},query:{},body:e.putFolderRequest},void 0,[][0]),(function(e){return L(new R(e).value())}))}catch(e){return Promise.reject(e)}}}])&&G(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(T);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function X(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function Y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==$(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===$(o)?o:String(o)),n)}var o}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e,t){if(t&&("object"===$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=re(n);if(o){var r=re(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return te(this,e)});function c(){return Y(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"cancelJob",value:function(e){try{var t=this;return X(t.request({path:"/v2/accounts/{accountId}/jobs/{jobType}/{jobId}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("jobId","}"),t.encodeParam("jobId",e.jobId)).replace("{".concat("jobType","}"),t.encodeParam("jobType",e.jobType)),method:"DELETE",headers:{},query:{}},void 0,[][0]),(function(e){return X(new q(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"getJob",value:function(e){try{var t=this;return X(t.request({path:"/v2/accounts/{accountId}/jobs/{jobType}/{jobId}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("jobId","}"),t.encodeParam("jobId",e.jobId)).replace("{".concat("jobType","}"),t.encodeParam("jobType",e.jobType)),method:"GET",headers:{},query:{}},void 0,[][0]),(function(e){return X(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"listRecentJobs",value:function(e){try{var t={};return e.jobType&&(t.jobType=e.jobType),X(this.request({path:"/v2/accounts/{accountId}/jobs".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"GET",headers:{},query:t},void 0,[][0]),(function(e){return X(new R(e).value())}))}catch(e){return Promise.reject(e)}}}])&&Z(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(T);function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ie(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==oe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===oe(o)?o:String(o)),n)}var o}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function le(e,t){if(t&&("object"===oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}var fe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ue(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=se(n);if(o){var r=se(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return le(this,e)});function c(){return ce(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"beginMultipartUpload",value:function(e){try{return ie(this.request({path:"/v2/accounts/{accountId}/uploads".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.beginMultipartUploadRequest},void 0,[][0]),(function(e){return ie(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"completeUploadPart",value:function(e){try{var t=this;return ie(t.request({path:"/v2/accounts/{accountId}/uploads/{uploadId}/parts/{uploadPartIndex}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("uploadId","}"),t.encodeParam("uploadId",e.uploadId)).replace("{".concat("uploadPartIndex","}"),t.encodeParam("uploadPartIndex",e.uploadPartIndex)),method:"PUT",headers:{"Content-Type":"application/json"},query:{},body:e.completeUploadPartRequest},void 0,[][0]),(function(e){return ie(new q(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"getUploadPart",value:function(e){try{var t=this;return ie(t.request({path:"/v2/accounts/{accountId}/uploads/{uploadId}/parts/{uploadPartIndex}".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("uploadId","}"),t.encodeParam("uploadId",e.uploadId)).replace("{".concat("uploadPartIndex","}"),t.encodeParam("uploadPartIndex",e.uploadPartIndex)),method:"GET",headers:{},query:{}},void 0,[][0]),(function(e){return ie(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"listUploadParts",value:function(e){try{var t=this;return ie(t.request({path:"/v2/accounts/{accountId}/uploads/{uploadId}/parts".replace("{".concat("accountId","}"),t.encodeParam("accountId",e.accountId)).replace("{".concat("uploadId","}"),t.encodeParam("uploadId",e.uploadId)),method:"GET",headers:{},query:{}},void 0,[][0]),(function(e){return ie(new R(e).value())}))}catch(e){return Promise.reject(e)}}},{key:"uploadFromUrl",value:function(e){try{return ie(this.request({path:"/v2/accounts/{accountId}/uploads/url".replace("{".concat("accountId","}"),this.encodeParam("accountId",e.accountId)),method:"POST",headers:{"Content-Type":"application/json"},query:{},body:e.uploadFromUrlRequest},void 0,[][0]),(function(e){return ie(new R(e).value())}))}catch(e){return Promise.reject(e)}}}])&&ae(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(T),de=!1;function pe(e){return void 0!==e[1]&&null!==e[1]}function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,c,a=[],u=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(e,t)||me(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ve(e){return function(e){if(Array.isArray(e))return be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||me(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){if(e){if("string"==typeof e)return be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(e,t):void 0}}function be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ye(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===ye(o)?o:String(o)),n)}var o}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"url",value:function(e){var t;return void 0===(null===(t=e.options)||void 0===t?void 0:t.transformation)?this.raw(e):this.transformation(e,e.options)}},{key:"raw",value:function(e){var t,r=this.getBaseUrl(e,"raw"),n=this.getCommonQueryParams(null!==(t=e.options)&&void 0!==t?t:{});return this.addQueryParams(r,n)}},{key:"transformation",value:function(e,t){var r,n=this.getBaseUrl(e,"preset"===t.transformation?t.transformationPreset:t.transformation),o="preset"===t.transformation?[]:this.getTransformationParams(t),i=this.getCommonQueryParams(null!==(r=e.options)&&void 0!==r?r:{}),c=this.getCommonTransformationQueryParams(t);return this.addQueryParams(n,[].concat(ve(o),ve(i),ve(c)))}},{key:"getBaseUrl",value:function(e,t){var r=k.defaultCdnUrl;return"".concat(r,"/").concat(e.accountId,"/").concat(t).concat(e.filePath)}},{key:"getCommonTransformationQueryParams",value:function(e){return this.makeQueryParams(["cachePermanently","artifact"],{cachePermanently:"cache_perm"})(e)}},{key:"getCommonQueryParams",value:function(e){return this.makeQueryParams(["auth","cache","cacheTtl","version","forceDownloadPrompt"],{cacheTtl:"cache_ttl",forceDownloadPrompt:"download"})(e)}},{key:"makeQueryParams",value:function(e,t){return function(r){var n=[];return e.forEach((function(e){var o,i=r[e];void 0!==i&&n.push([null!==(o=t[e])&&void 0!==o?o:e,i.toString()])})),n}}},{key:"getTransformationParams",value:function(e){var t=e.transformationParams;if(void 0===t)return[];var r=function(e){return Object.entries(e).filter(pe).map((function(e){var t=he(e,2);return[t[0],t[1].toString()]}))};return Array.isArray(t)?t.flatMap(r):r(t)}},{key:"addQueryParams",value:function(e,t){return 0===t.length?e:"".concat(e,"?").concat(t.map((function(e){var t=he(e,2),r=t[0],n=t[1];return"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(n))})).join("&"))}}],null&&Pe(t.prototype,null),r&&Pe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),ge=!1;function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Se(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function Ie(e,t,r){if(!e.s){if(r instanceof Oe){if(!r.s)return void(r.o=Ie.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(Ie.bind(null,e,t),Ie.bind(null,e,2));e.s=t,e.v=r;var n=e.o;n&&n(e)}}var Oe=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,o=this.s;if(o){var i=1&o?t:r;if(i){try{Ie(n,1,i(this.v))}catch(e){Ie(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?Ie(n,1,t?t(o):o):r?Ie(n,1,r(o)):Ie(n,2,o)}catch(e){Ie(n,2,e)}},n},e}();function ke(e){return e instanceof Oe&&1&e.s}function Te(e){return function(e){if(Array.isArray(e))return Ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ee(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ae(){}function Ue(e,t){if(!t)return e&&e.then?e.then(Ae):Promise.resolve()}function Re(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==je(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===je(o)?o:String(o)),n)}var o}function Ce(e){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ce(e)}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==Ce(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===Ce(o)?o:String(o)),n)}var o}function Be(e,t){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Be(e,t)}function Fe(e,t){if(t&&("object"===Ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Me(e){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Me(e)}var Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Be(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(n);if(o){var r=Me(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Fe(this,e)});function c(){return xe(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"processUploadSource",value:function(e){if("string"==typeof e)return{type:"Blob",value:new Blob([e],{type:this.stringMimeType})};if(void 0!==e.byteLength)return{type:"ArrayBuffer",value:e};if(void 0!==e.size)return{type:"Blob",value:e};throw new Error("Unsupported type for 'data' parameter. Please provide a String, Blob, ArrayBuffer, or File object (from a file input element).")}},{key:"getPreUploadInfoPartial",value:function(e,t){switch(t.type){case"Blob":return this.getBlobInfo(t);case"ArrayBuffer":return{mime:void 0,size:t.value.byteLength,originalFileName:void 0,maxConcurrentUploadParts:void 0};default:!function(e){throw new Error("Didn't expect to get here: ".concat(JSON.stringify(e)))}(t)}}},{key:"preUpload",value:function(e){}},{key:"postUpload",value:function(e){return t&&t.then||(t=Promise.resolve(t)),t;var t}},{key:"getRequestBody",value:function(e,t){return-1===e.range.inclusiveEnd?new Blob:t.value.slice(e.range.inclusiveStart,e.range.inclusiveEnd+1)}}])&&_e(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.stringMimeType="text/plain",this.defaultMaxConcurrentUploadParts=4,this.intervalMs=500,this.uploadApi=new fe(t),this.accountId=k.getAccountId(t)}var t,r;return t=e,(r=[{key:"upload",value:function(e){try{var t=this;t.assertNotCancelled(e);var r=t.processUploadSource(e.data),n=t.getPreUploadInfo(e,r),o=n.size,i=t.makeOnProgressForPartFactory(e,o),c=t.preUpload(r);return void 0!==e.onProgress&&e.onProgress(t.makeProgressEvent(0,o)),Re(t.beginUpload(e,n),(function(o){var a,u,l=o.uploadParts.count,s=Te(Array(l).keys()),f=t.makeCancellationMethods(),d=f.cancel,p=f.addCancellationHandler,y=setInterval(t.onIntervalTick(e,d),t.intervalMs);return u=function(){return o.file},(a=function(a,u){try{var l=Re(t.mapAsync(s,n.maxConcurrentUploadParts,Se((function(n){return t.uploadPart(e,r,n,o,i(),p)}))),(function(){return Ue(t.postUpload(c))}))}catch(e){return u(!0,e)}return l&&l.then?l.then(u.bind(null,!1),u.bind(null,!0)):u(!1,l)}(0,(function(e,t){return clearInterval(y),function(e,t){if(e)throw t;return t}(e,t)})))&&a.then?a.then(u):u()}))}catch(e){return Promise.reject(e)}}},{key:"getBlobInfo",value:function(e){var t=e.value,r=t.name,n=t.size;return{mime:t.type,size:n,originalFileName:r,maxConcurrentUploadParts:void 0}}},{key:"onIntervalTick",value:function(e,t){var r=this;return function(){r.isCancelled(e)&&t()}}},{key:"makeCancellationMethods",value:function(){var e=[];return{cancel:function(){return e.forEach((function(e){return e()}))},addCancellationHandler:function(t){e.push(t)}}}},{key:"makeOnProgressForPartFactory",value:function(e,t){var r=this,n=e.onProgress;if(void 0===n)return function(){return function(){}};var o=0;return function(){var e=0;return function(i){var c=i-e;e+=c,o+=c,n(r.makeProgressEvent(o,t))}}}},{key:"makeProgressEvent",value:function(e,t){return{bytesTotal:t,bytesSent:e,progress:Math.round(e/t*100)}}},{key:"assertNotCancelled",value:function(e){if(this.isCancelled(e))throw new E}},{key:"isCancelled",value:function(e){var t;return!0===(null===(t=e.cancellationToken)||void 0===t?void 0:t.isCancelled)}},{key:"beginUpload",value:function(e,t){var r=t.size,n=t.mime,o=t.originalFileName;try{return Re(this.uploadApi.beginMultipartUpload({accountId:this.accountId,beginMultipartUploadRequest:{metadata:e.metadata,mime:n,originalFileName:o,path:e.path,protocol:"1.1",size:r,tags:e.tags}}))}catch(e){return Promise.reject(e)}}},{key:"uploadPart",value:function(e,t,r,n,o,i){try{var c=this;return c.assertNotCancelled(e),Re(c.getUploadPart(r,n),(function(a){return c.assertNotCancelled(e),Re(c.putUploadPart(a,t,o,i),(function(t){return c.assertNotCancelled(e),Ue(c.uploadApi.completeUploadPart({accountId:c.accountId,uploadId:n.uploadId,uploadPartIndex:r,completeUploadPartRequest:{etag:t}}))}))}))}catch(e){return Promise.reject(e)}}},{key:"putUploadPart",value:function(e,t,r,n){try{var o=e.range.inclusiveEnd+1-e.range.inclusiveStart;return Re(this.doPutUploadPart(e,o,t,r,n),(function(e){var t=e.status,n=e.etag;if(2!==Math.floor(t/100))throw new Error("Failed to upload part (".concat(t,")."));if(void 0===n)throw new Error("No 'etag' response header found in upload part response.");return r(o),n}))}catch(e){return Promise.reject(e)}}},{key:"getUploadPart",value:function(e,t){try{return 0===e?t.uploadParts.first:Re(this.uploadApi.getUploadPart({uploadId:t.uploadId,accountId:this.accountId,uploadPartIndex:e}))}catch(e){return Promise.reject(e)}}},{key:"getPreUploadInfo",value:function(e,t){var r,n,o,i=this.getPreUploadInfoPartial(e,t);return{maxConcurrentUploadParts:null!==(r=i.maxConcurrentUploadParts)&&void 0!==r?r:this.defaultMaxConcurrentUploadParts,originalFileName:null!==(n=e.originalFileName)&&void 0!==n?n:i.originalFileName,mime:null!==(o=e.mime)&&void 0!==o?o:i.mime,size:i.size}}},{key:"mapAsync",value:function(e,t,r){try{var n=Te(e);return Ue(Promise.all(Te(Array(t).keys()).map(Se((function(){return function(e){if(e&&e.then)return e.then(Ae)}(function(e,t,r){for(var n;;){var o=e();if(ke(o)&&(o=o.v),!o)return c;if(o.then){n=0;break}var i,c=r();if(c&&c.then){if(!ke(c)){n=1;break}c=c.s}}var a=new Oe,u=Ie.bind(null,a,2);return(0===n?o.then(s):1===n?c.then(l):i.then(f)).then(void 0,u),a;function l(t){c=t;do{if(!(o=e())||ke(o)&&!o.v)return void Ie(a,1,c);if(o.then)return void o.then(s).then(void 0,u);ke(c=r())&&(c=c.v)}while(!c||!c.then);c.then(l).then(void 0,u)}function s(e){e?(c=r())&&c.then?c.then(l).then(void 0,u):l(c):Ie(a,1,c)}function f(){(o=e())?o.then?o.then(s).then(void 0,u):s(o):Ie(a,1,c)}}((function(){return n.length>0}),0,(function(){var e=n.shift();return function(t){var n=function(){if(void 0!==e)return Ue(r(e))}();if(n&&n.then)return n.then(Ae)}()})))})))))}catch(e){return Promise.reject(e)}}}])&&qe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}());function De(e){return De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},De(e)}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==De(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==De(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===De(o)?o:String(o)),n)}var o}function Le(e,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Le(e,t)}function ze(e,t){if(t&&("object"===De(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ge(e){return Ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ge(e)}var Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Le(e,t)}(c,e);var t,r,n,o,i=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ge(n);if(o){var r=Ge(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ze(this,e)});function c(){return Je(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"doPutUploadPart",value:function(e,t,r,n,o){try{var i=this,c=new XMLHttpRequest,a=!0;return o((function(){a&&c.abort()})),function(t,o){try{var a=(u=new Promise((function(t,o){c.upload.addEventListener("progress",(function(e){e.lengthComputable&&n(e.loaded)}),!1),c.addEventListener("load",(function(){var e,r=null!==(e=c.getResponseHeader("etag"))&&void 0!==e?e:void 0;t({etag:r,status:c.status})})),c.onabort=function(){return o(new E)},c.onerror=function(){return o(new Error("File upload error."))},c.ontimeout=function(){return o(new Error("File upload timeout."))},c.open("PUT",e.uploadUrl),c.send(i.getRequestBody(e,r))})),s?l?l(u):u:(u&&u.then||(u=Promise.resolve(u)),l?u.then(l):u))}catch(e){return o(!0,e)}var u,l,s;return a&&a.then?a.then(o.bind(null,!1),o.bind(null,!0)):o(!1,a)}(0,(function(e,t){return a=!1,function(e,t){if(e)throw t;return t}(e,t)}))}catch(e){return Promise.reject(e)}}}])&&Ke(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),c}(Ne);function He(e){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},He(e)}function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==He(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===He(o)?o:String(o)),n)}var o}var Ve=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"error",value:function(t){console.error(e.prefix(t))}},{key:"warn",value:function(t){console.warn(e.prefix(t))}},{key:"prefix",value:function(e){return"[bytescale-sdk] ".concat(e)}}],null&&We(t.prototype,null),r&&We(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function Xe(){}function Ye(e,t){if(!t)return e&&e.then?e.then(Xe):Promise.resolve()}function Ze(e,t,r){return r?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function et(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rt(n.key),n)}}function rt(e){var t=function(e,t){if("object"!==$e(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==$e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===$e(t)?t:String(t)}var nt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType="content-type",this.contentTypeJson="application/json",this.contentTypeText="text/plain",this.minJwtTtlSeconds=10,this.maxJwtTtlSeconds=2147483,this.retryAuthAfterErrorSeconds=5,this.refreshBeforeExpirySeconds=20,this.authSessionMutex=u.getMutex()}var t,r;return t=e,(r=[{key:"isAuthSessionActive",value:function(){return void 0!==u.getSession()}},{key:"beginAuthSession",value:function(e){try{var t=this,r={accessToken:void 0,accessTokenRefreshHandle:void 0,params:e,isActive:!0};return Ze(t.authSessionMutex.safe(et((function(){if(t.isAuthSessionActive())throw new Error("Auth session already active. Please call 'await endAuthSession()' and then call 'await beginAuthSession(...)' to start a new auth session.");return u.setSession(r),Ze()}))),(function(){return Ye(t.refreshAccessToken(r))}))}catch(e){return Promise.reject(e)}}},{key:"endAuthSession",value:function(){try{var e=this;return Ye(e.authSessionMutex.safe(et((function(){var t=u.getSession();if(void 0!==t)return u.setSession(void 0),t.isActive=!1,void 0!==t.accessTokenRefreshHandle&&clearTimeout(t.accessTokenRefreshHandle),Ye(e.deleteAccessToken(t.params))}))))}catch(e){return Promise.reject(e)}}},{key:"refreshAccessToken",value:function(e){try{var t=this;return Ye(t.authSessionMutex.safe(et((function(){if(e.isActive){var r=t.retryAuthAfterErrorSeconds;return function(e){if(e&&e.then)return e.then(Xe)}(function(n,o){try{var i=function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}((function(){var n=t.getAccessToken,o=e.params;return Ze(e.params.authHeaders(),(function(i){return Ze(n.call(t,o,i),(function(n){return Ze(t.setAccessToken(e.params,n),(function(n){var o=n.ttlSeconds-t.refreshBeforeExpirySeconds;o!==(r=Math.max(o,t.minJwtTtlSeconds))&&Ve.warn("JWT expiration is too short: waiting for ".concat(r," seconds before refreshing.")),r=Math.min(r,t.maxJwtTtlSeconds),e.accessToken=n.accessToken}))}))}))}),(function(e){Ve.error("Error when refreshing access token: ".concat(e))}))}catch(e){return o(!0,e)}return i&&i.then?i.then(o.bind(null,!1),o.bind(null,!0)):o(!1,i)}(0,(function(n,o){return e.accessTokenRefreshHandle=window.setTimeout((function(){t.refreshAccessToken(e).then((function(){}),(function(e){return Ve.error("Unexpected error when refreshing access token: ".concat(e))}))}),1e3*r),function(e,t){if(e)throw t;return t}(n,o)})))}}))))}catch(e){return Promise.reject(e)}}},{key:"getAccessTokenUrl",value:function(e){var t,r=k.getCdnUrl(null!==(t=e.options)&&void 0!==t?t:{});return"".concat(r,"/api/v1/access_tokens/").concat(e.accountId)}},{key:"deleteAccessToken",value:function(e){try{var t;return Ye(T.fetch(this.getAccessTokenUrl(e),{method:"DELETE",credentials:"include",headers:{}},{isBytescaleApi:!0,fetchApi:null===(t=e.options)||void 0===t?void 0:t.fetchApi}))}catch(e){return Promise.reject(e)}}},{key:"setAccessToken",value:function(e,t){try{var r,n=this,o={accessToken:t};return Ze(T.fetch(n.getAccessTokenUrl(e),{method:"PUT",credentials:"include",headers:(i={},c=n.contentType,a=n.contentTypeJson,(c=rt(c))in i?Object.defineProperty(i,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[c]=a,i),body:JSON.stringify(o)},{isBytescaleApi:!0,fetchApi:null===(r=e.options)||void 0===r?void 0:r.fetchApi}),(function(e){return Ze(e.json())}))}catch(e){return Promise.reject(e)}var i,c,a}},{key:"getAccessToken",value:function(e,t){try{var r,n,o=this,i="Your auth API endpoint",c=o.contentTypeText;return Ze(T.fetch(e.authUrl,{method:"GET",headers:t},{isBytescaleApi:!1,fetchApi:null===(r=e.options)||void 0===r?void 0:r.fetchApi}),(function(e){var t=null!==(n=e.headers.get(o.contentType))&&void 0!==n?n:"";if(t.split(";")[0]!==c)throw new Error("".concat(i,' returned "').concat(t,'" for the ').concat(o.contentType,' response header, but the Bytescale SDK requires "').concat(c,'".'));return Ze(e.text(),(function(e){if(0===e.length)throw new Error("".concat(i," returned an empty string. Please return a valid JWT instead."));if(e.trim().length!==e.length)throw new Error("".concat(i," returned whitespace around the JWT, please remove it."));return e}))}))}catch(e){return Promise.reject(e)}}}])&&tt(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}());return t}()}));